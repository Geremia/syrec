# Modifications to the ANTLR grammar

The scanner/lexer and parser for the SyReC grammar were generated using the parser generator [ANTLR](https://github.com/antlr/antlr4) with the grammar being defined in the files _TSyrecLexer.g4_ and _TSyrecParser.g4_, the former defines the tokens/terminal symbols of the grammar while the latter defines the productions/non-terminal symbols (both files are located in the git repository under {code}`src/core/syrec/parser/antlr/grammar`). No C++ code is embedded in the two _.g4_ files so these files can be used to generate a basic SyReC parser for another programming languages using ANTLR.

The header files generated by the parser generator are located in {code}`include/core/syrec/parser/antlr` while the source files are found in {code}`src/core/syrec/parser/antlr`.
The files of the ANTLR runtime required for the build of the generated header and source files of the SyReC parser are made available at configure time and are built with the C++ library.

Changes in the _.g4_ files of the scanner and parser are not automatically available in the C++ header/source files but require an execution of the parser generator with two options for how the parser generator can be invoked:

1. Include the parser generator into CMake as described in the [official ANTLR repository](https://github.com/antlr/antlr4/tree/dev/runtime/Cpp/cmake) which would require an existing Java SE installation of the system performing the build.
2. A manual execution of the parser generator on the machine of the developer followed by an update of the already existing files.

To keep the number of external dependencies for this project low and due to the expected infrequent changes to the SyReC grammar, the second option is the recommended one, with a manual execution of the parser generator via the command line requiring the following steps (with the assumption that the execution is performed on Windows with other operating systems only requiring minor changes):

1. Download the [ANTLR java binary](https://www.antlr.org/download.html) and copy it to a location of your choice.
2. Assuming that the _antlr.jar_ is located in the same folder as the _.g4_ grammar files and that the Java binary is available in the command line, execute the following command:

   ```console
   $ java -jar antlr.jar -Dlanguage=Cpp -package syrec_parser -o <OUTPUT_DIRECTORY_FOR_GEN_FILES> -no-visitor -no-listener -Werror TSyrecLexer.g4 TSyrecParser.g4
   ```

   Out of all the generated files in the specified _<OUTPUT_DIRECTORY_FOR_GEN_FILES>_ directory only the _TSyrecLexer.h_, _TSyrecLexer.cpp_, _TSyrecParser.h_, _TSyrecParser.cpp_ are relevant for the C++ library.

3. Copy the relevant files generated in the previous step to the corresponding folders in the project:

- Header files: {code}`include/core/syrec/parser/antlr`
- Source files: {code}`src/core/syrec/parser/antlr`

```{note}
Executing the .clang-tidy and .clang-format checks for the generated header and source files will result in a large number of warnings being reported that need to be fixed prior to any pull-request.
We recommend that one uses a diff-tool to determine the changes between the current implementation and the newly generated code and then merge the relevant portions of the new code into the existing one. Changes in the *.g4* grammar files might also require an update of the implementation of the parser components (in {code}`src/core/syrec/parser/components`).
```
